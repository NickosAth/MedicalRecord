@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<!DOCTYPE html>
<html>
<head>
	<title>Προσωπικά στοιχεία ασθενούς</title>
	<style>
		* {
			box-sizing: border-box;
			font-family: Arial, sans-serif;
		}

		body {
			background-image: url('https://plus.unsplash.com/premium_photo-1658506952749-8df0057c5c03?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTl8fGhvc3BpdGFsfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60');
			background-size: cover;
			background-position: center center;
			font-family: 'Open Sans', sans-serif;
		}

		.container::before {
			content: "";
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: -1;
			background-image: url('https://plus.unsplash.com/premium_photo-1658506952749-8df0057c5c03?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTl8fGhvc3BpdGFsfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60');
			background-size: cover;
			background-position: center center;
			filter: blur(20px);
		}
		
		form {
			max-width: 500px;
			margin: 0 auto;
			padding: 20px;
			background-color: #f2f2f2;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		h2 {
			text-align: center;
			font-weight: bold;
			color: #333;
			margin-top: 50px;
			background-image: url('https://images.unsplash.com/photo-1572541077501-c74b82f43b19');
			background-size: cover;
			background-position: center center;
			padding: 30px;
			border-radius: 10px;
			box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.2);
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
		}

		label {
			display: block;
			font-weight: bold;
			margin-top: 10px;
		}

		input[type="text"], select {
			width: 100%;
			padding: 12px;
			border: 1px solid #ccc;
			border-radius: 4px;
			resize: vertical;
			font-size: 16px;
			background-color: #fff;
		}

		input[type="submit"] {
			background-color: #4CAF50;
			color: #fff;
			padding: 12px 20px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-size: 16px;
		}

			input[type="submit"]:hover {
				background-color: #45a049;
			}

		.container {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
		}

		.col-25 {
			flex: 25%;
			max-width: 100%;
		}

		.col-50 {
			flex: 50%;
			max-width: 100%;
		}

		.col-75 {
			flex: 75%;
			max-width: 100%;
		}


		.col-25,
		.col-50,
		.col-75 {
			padding: 0 20px;
			margin-bottom: 10px;
		}
		 .error-message {
            color: red;
            font-size: 12px;
            margin-top: 5px;
        }
	</style>
</head>
<body>
	<h2>Προσωπικά στοιχεία ασθενούς</h2>
	<div class="container">
	</div>
	<form id="patientForm" method="post" action="@Url.Action("Create", "CreateClient")">
		<div class="form-group">
			<label for="first_name">Όνομα:</label>
			<input type="text" class="form-control" id="first_name" name="FirstName" required>
		</div>
		<div class="form-group">
			<label for="last_name">Επώνυμο:</label>
			<input type="text" class="form-control" id="last_name" name="LastName" required>
		</div>
		<div class="form-group">
			<label for="father_name">Πατρώνυμο:</label>
			<input type="text" class="form-control" id="father_name" name="FathersName" required>
		</div>
		<div class="form-group">
			<label for="gender">Φύλο:</label>
			<select class="form-control" id="gender" name="Gender" required>
				<option value="Άνδρας">Άνδρας</option>
				<option value="Γυναίκα">Γυναίκα</option>
			</select>
		</div>
		<div class="form-group">
			<label for="birth_date">Ημερομηνία Γέννησης:</label>
			<input type="date" class="form-control" id="birth_date" name="Dob" required>
		</div>
		<div class="form-group">
			<label for="amka">Α.Μ.Κ.Α.:</label>
			<input type="text" class="form-control" id="amka" name="Amka" required>
		</div>
		<div class="form-group">
			<label for="work">Επάγγελμα:</label>
			<input type="text" class="form-control" id="work" name="Job" required>
		</div>
		<div class="form-group">
			<label for="insurance_fund">Ταμείο:</label>
			<select class="form-control" id="insurance_fund" name="Insurance" required>
				<option value="Ι.Κ.Α.">Ι.Κ.Α.</option>
				<option value="Ο.Γ.Α.">Ο.Γ.Α.</option>
				<option value="Τ.Ε.Β.Ε.">Τ.Ε.Β.Ε.</option>
				<option value="Ο.Α.Ε.Ε.">Ο.Α.Ε.Ε.</option>
				<option value="Ο.Α.Ε.Κ.">Ο.Α.Ε.Κ.</option>
			</select>
		</div>
		<div class="form-group">
			<label for="marital_status">Οικογενειακή Κατάσταση:</label>
			<select class="form-control" id="marital_status" name="FamilyStatus" required>
				<option value="Άγαμος/η">Άγαμος/η</option>
				<option value="Παντρεμένος/η">Παντρεμένος/η</option>
				<option value="Διαζευγμένος/η">Διαζευγμένος/η</option>
				<option value="Χήρος/α">Χήρος/α</option>
			</select>
		</div>
		<div class="form-group">
			<label for="phone_number">Τηλέφωνο:</label>
			<input type="text" class="form-control" id="phone_number" name="Phone" pattern="[0-9]{10}" required>
		</div>
		<div class="form-group">
			<label for="email">Email:</label>
			<input type="email" class="form-control" id="email" name="Email" required>
		</div>
		<div class="form-group">
			<label for="town">Περιοχή Κατοικίας:</label>
			<input type="text" class="form-control" id="username" name="AreaOfResidence" required>
		</div>
		<div class="form-group">
			<label for="town">Πόλη Κατοικίας:</label>
			<input type="text" class="form-control" id="username" name="CityOfResidence" required>
		</div>
		<div class="form-group">
			<label for="address">Διεύθυνση Κατοικίας:</label>
			<input type="text" class="form-control" id="address" name="AddressOfResidence" required>
		</div>
		<div class="form-group">
			<label for="TK">ΤΚ Κατοικίας:</label>
			<input type="text" class="form-control" id="TK" name="ZipCodeOfResidence" required>
		</div>
		<div class="form-group text-center mt-4">
			<button id="submitBtn" type="submit" class="btn btn-danger">Εγγραφή</button>
		</div>
	</form>
	<!-- Success message element -->
	<div id="success-message" style="display: none; text-align: center; color: green;">
		Επιτυχής εγγραφή! Παρακαλώ περιμένετε...
	</div>

</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function () {
		var validationMessages = {};
		var realTimeValidationMessages = {};

		$('#username, #phone, #email').on('input', function () {
			var inputId = $(this).attr('id');
			var inputValue = $(this).val();

			$.ajax({
				url: '/CreateClient/' + inputId, // Adjust the URL to match your route for client creation
				type: 'GET',
				data: { value: inputValue },
				success: function (result) {
					realTimeValidationMessages[inputId] = result.exists ? 'This ' + inputId + ' is already taken.' : '';
					updateValidationMessages();
					updateSubmitButtonState();
				}
			});
		});

		$('#phone').on('input', function () {
			var phoneInput = $(this);
			var phoneValue = phoneInput.val();
			var validationMessage = $('#phone-validation-message');

			var cleanPhoneValue = phoneValue.replace(/\D/g, '');
			phoneInput.val(cleanPhoneValue);

			if (cleanPhoneValue.length !== 10) {
				realTimeValidationMessages['phone'] = 'Please enter a valid 10-digit phone number.';
			} else {
				realTimeValidationMessages['phone'] = ''; // Clear the message if we have 10 digits
			}

			updateValidationMessages();
			updateSubmitButtonState();
		});

		$('input, select').on('input', function () {
			var inputId = $(this).attr('id');
			validationMessages[inputId] = '';
			updateValidationMessages();
			updateSubmitButtonState();
		});

		function updateValidationMessages() {
			for (var inputId in validationMessages) {
				var validationMessage = $('#' + inputId + '-validation-message');
				validationMessage.text(validationMessages[inputId] || realTimeValidationMessages[inputId]);
			}
		}

		function updateSubmitButtonState() {
			var hasEmptyFields = $('input[required]').filter(function () {
				return !$(this).val();
			}).length > 0;

			var hasValidationMessage = $('.text-danger').filter(function () {
				return $(this).text() !== '';
			}).length > 0;

			var phoneValue = $('#phone').val();
			var invalidPhoneLength = phoneValue.replace(/\D/g, '').length !== 10;

			$('#submitBtn').prop('disabled', hasEmptyFields || hasValidationMessage || invalidPhoneLength);
		}

		$('#submitBtn').click(function (e) {
			e.preventDefault(); // Prevent the default form submission

			// Assuming your AJAX request to check input validity is correct

			// Add the client to the database
			$.ajax({
				url: '/CreateClient/Create',
				type: 'POST',
				data: $('#patientForm').serialize(),
				success: function (result) {
					$('#success-message').show();

					// Use setTimeout to delay the redirection
					setTimeout(function () {
						window.location.href = '@Url.Action("Index", "ShowClients")'; // Redirect after 3 seconds
					}, 3000); // Wait for 3 seconds before redirecting
				},
				error: function () {
					// Handle any errors if the client creation fails
				}
			});
		});

		updateValidationMessages();
		updateSubmitButtonState();
	});
</script>
</html>